{
	"name": "VFD_PL_Mida2_Test_Setup",
	"properties": {
		"description": "Setup ambiente di test - pulizia cartelle e preparazione",
		"activities": [
			{
				"name": "Delete_Old_Complete_File",
				"type": "Delete",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"dataset": {
						"referenceName": "VFD_DS_Curated_Mida_Bookings_Complete_Parquet",
						"type": "DatasetReference",
						"parameters": {
							"folderPath": "Mida2/Test/Complete/2025/01",
							"fileName": "test_complete.parquet"
						}
					},
					"enableLogging": false,
					"storeSettings": {
						"type": "AzureBlobFSReadSettings",
						"recursive": false,
						"enablePartitionDiscovery": false
					}
				}
			},
			{
				"name": "Delete_Old_Summary_File",
				"type": "Delete",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"dataset": {
						"referenceName": "VFD_DS_Curated_Mida_Bookings_Summary_Parquet",
						"type": "DatasetReference",
						"parameters": {
							"folderPath": "Mida2/Test/Summary/2025/01",
							"fileName": "test_summary.parquet"
						}
					},
					"enableLogging": false,
					"storeSettings": {
						"type": "AzureBlobFSReadSettings",
						"recursive": false,
						"enablePartitionDiscovery": false
					}
				}
			},
			{
				"name": "Delete_Old_Historical_File",
				"type": "Delete",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"dataset": {
						"referenceName": "VFD_DS_Curated_Mida_Historical_Parquet",
						"type": "DatasetReference",
						"parameters": {
							"folderPath": "Mida2/Test/Historical/2025/01",
							"fileName": "test_historical.parquet"
						}
					},
					"enableLogging": false,
					"storeSettings": {
						"type": "AzureBlobFSReadSettings",
						"recursive": false,
						"enablePartitionDiscovery": false
					}
				}
			},
			{
				"name": "Delete_Temp_Files",
				"type": "Delete",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"dataset": {
						"referenceName": "VFD_DS_Curated_Mida_Temp_Parquet",
						"type": "DatasetReference",
						"parameters": {
							"folderPath": "Mida2/Test/Temp",
							"fileName": "*.parquet"
						}
					},
					"enableLogging": false,
					"storeSettings": {
						"type": "AzureBlobFSReadSettings",
						"recursive": true,
						"wildcardFileName": "*.parquet",
						"enablePartitionDiscovery": false
					}
				}
			},
			{
				"name": "Delete_Lookup_Results",
				"type": "Delete",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"dataset": {
						"referenceName": "VFD_DS_Curated_Mida_Temp_Parquet",
						"type": "DatasetReference",
						"parameters": {
							"folderPath": "Mida2/Test/Lookup",
							"fileName": "*.parquet"
						}
					},
					"enableLogging": false,
					"storeSettings": {
						"type": "AzureBlobFSReadSettings",
						"recursive": true,
						"wildcardFileName": "*.parquet",
						"enablePartitionDiscovery": false
					}
				}
			},
			{
				"name": "Wait_For_Cleanup",
				"type": "Wait",
				"dependsOn": [
					{
						"activity": "Delete_Old_Complete_File",
						"dependencyConditions": [
							"Completed"
						]
					},
					{
						"activity": "Delete_Old_Summary_File",
						"dependencyConditions": [
							"Completed"
						]
					},
					{
						"activity": "Delete_Old_Historical_File",
						"dependencyConditions": [
							"Completed"
						]
					},
					{
						"activity": "Delete_Temp_Files",
						"dependencyConditions": [
							"Completed"
						]
					},
					{
						"activity": "Delete_Lookup_Results",
						"dependencyConditions": [
							"Completed"
						]
					}
				],
				"userProperties": [],
				"typeProperties": {
					"waitTimeInSeconds": 2
				}
			},
			{
				"name": "Set_Test_Start_Time",
				"type": "SetVariable",
				"dependsOn": [
					{
						"activity": "Wait_For_Cleanup",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"variableName": "testStartTime",
					"value": {
						"value": "@utcnow()",
						"type": "Expression"
					}
				}
			}
		],
		"variables": {
			"testStartTime": {
				"type": "String"
			}
		},
		"folder": {
			"name": "Mida2/Test"
		},
		"annotations": [
			"Pipeline di setup per test atomici",
			"Pulisce ambiente test prima dell'esecuzione"
		]
	}
}